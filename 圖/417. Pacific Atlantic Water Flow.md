

---

## LeetCode 417. Pacific Atlantic Water Flow

### 簡要回答

題目要求找出矩陣中所有能同時流到「太平洋」和「大西洋」的格子。解法是 **反向思考**：
從海邊往內 DFS/BFS，標記能到達的格子，最後取交集。

---

### 延伸回答

1. **核心思路**

   * 正向思考（水流從內陸往海邊走）會很複雜。
   * 改成反向：從邊界（太平洋邊、大西洋邊）往裡跑 DFS，凡是高度「不下降」的地方都能被標記為可達。
   * 分別建立 `firboard`（能流到太平洋）和 `secboard`（能流到大西洋），最後取交集。

2. **流程**

   * 建立兩個布林矩陣 `firboard`、`secboard`，初始值全為 `false`。
   * 以太平洋邊界（上、左）當作起點，做 DFS，標記所有能到達的格子。
   * 以大西洋邊界（下、右）當作起點，做 DFS，標記所有能到達的格子。
   * 最後掃描整個矩陣，凡是兩個布林矩陣都為 `true` 的格子，就是答案。

3. **複雜度分析**

   * 時間複雜度：
     每個點最多被 DFS/BFS 訪問一次，O(m\*n)。
   * 空間複雜度：
     使用兩個 m×n 的布林矩陣，O(m\*n)。

---

### 程式碼

```cpp
class Solution {
public:
    int dir[4][2] = {{0,1},{0,-1},{1,0},{-1,0}};

    void dfs(vector<vector<int>>& heights, int x, int y, vector<vector<bool>>& visited) {
        if (visited[x][y]) return;

        visited[x][y] = true; // 標記訪問過
        for (int i = 0; i < 4; i++) {
            int nextx = x + dir[i][0];
            int nexty = y + dir[i][1];
            if (nextx < 0 || nextx >= heights.size() || nexty < 0 || nexty >= heights[0].size())
                continue;
            if (heights[nextx][nexty] >= heights[x][y]) {
                dfs(heights, nextx, nexty, visited);
            }
        }
    }

    vector<vector<int>> pacificAtlantic(vector<vector<int>>& heights) {
        vector<vector<int>> result;
        int m = heights.size(), n = heights[0].size();

        vector<vector<bool>> firboard(m, vector<bool>(n, false));
        vector<vector<bool>> secboard(m, vector<bool>(n, false));

        // 從太平洋邊界出發 (上、左)
        for (int i = 0; i < n; i++) {
            dfs(heights, 0, i, firboard);
            dfs(heights, m - 1, i, secboard);
        }
        for (int i = 0; i < m; i++) {
            dfs(heights, i, 0, firboard);
            dfs(heights, i, n - 1, secboard);
        }

        // 找交集
        for (int i = 0; i < m; i++) {
            for (int j = 0; j < n; j++) {
                if (firboard[i][j] && secboard[i][j]) {
                    result.push_back({i, j});
                }
            }
        }
        return result;
    }
};
```

---
